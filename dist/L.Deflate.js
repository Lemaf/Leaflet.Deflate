L.Deflate=function(e){function r(e,r){var o=e.getBounds(),a=u.project(o.getNorthEast(),r),t=u.project(o.getSouthWest(),r),n=a.x-t.x,d=t.y-a.y;return s>d||s>n}function o(e){var o=null,a=u.getZoom();if(r(e,u.getZoom()))for(;!o;)a+=1,r(e,a)||(o=a-1);else for(;!o;)a-=1,r(e,a)&&(o=a);return o}function a(e){var r=e.layer;if(!r._layers&&r.getBounds&&!r.zoomThreshold&&!r.marker){var a=o(r),t=L.marker(r.getBounds().getCenter());r._popupHandlersAdded&&t.bindPopup(r._popup._content),r.zoomThreshold=a,r.marker=t,u.getZoom()<=a&&(d.removeLayer(r),d.addLayer(r.marker),m.push(r))}}function t(){d!==u&&u.removeLayer(d);var e=[];d.eachLayer(function(r){u.getZoom()<=r.zoomThreshold&&(d.removeLayer(r),d.addLayer(r.marker),e.push(r))});for(var r=0;r<m.length;r++){var o=m[r];u.getZoom()>o.zoomThreshold&&(d.removeLayer(o.marker),d.addLayer(o),m.splice(r,1),r-=1)}d!==u&&u.addLayer(d),m=m.concat(e)}function n(r){d=e.featureGroup||r,u=r,d.on("layeradd",a),u.on("zoomend",t)}var d,u,m=[],s=e.minSize||10;return{addTo:n}};