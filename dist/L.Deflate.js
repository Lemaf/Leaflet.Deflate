L.Deflate=function(o){function r(o,r){var e=o.getBounds(),n=i.project(e.getNorthEast(),r),a=i.project(e.getSouthWest(),r),t=n.x-a.x;return a.y-n.y<m||t<m}function e(o){var e=null,n=i.getZoom();if(r(o,i.getZoom()))for(;!e;)r(o,n+=1)||(e=n-1);else for(;!e;)r(o,n-=1)&&(e=n);return e}function n(r){var n=r.layer;if(!n._layers&&n.getBounds&&!n.zoomThreshold&&!n.marker){var a=e(n);if(o.icon&&o.markerColor)var m=L.VectorMarkers.icon({markerColor:o.markerColor,iconColor:o.iconColor?o.iconColor:"#000000",icon:o.icon});var c=L.marker(n.getBounds().getCenter(),{icon:m});n._popupHandlersAdded&&c.bindPopup(n._popup._content);var p=n._events;for(var r in p)if(p.hasOwnProperty(r))for(var s=p[r],u=0,f=s.length;u<f;u++)c.on(r,s[u].fn);if(o.optionsToCopy)for(var l in o.optionsToCopy){var v=o.optionsToCopy[l];c.options[v]=n.options[v]}n.zoomThreshold=a,n.marker=c,i.getZoom()<=a&&(t.removeLayer(n),t.addLayer(n.marker),d.push(n))}}function a(){t!==i&&i.removeLayer(t);var o=[];t.eachLayer(function(r){i.getZoom()<=r.zoomThreshold&&(t.removeLayer(r),t.addLayer(r.marker),o.push(r))});for(var r=0;r<d.length;r++){var e=d[r];i.getZoom()>e.zoomThreshold&&(t.removeLayer(e.marker),t.addLayer(e),d.splice(r,1),r-=1)}t!==i&&i.addLayer(t),d=d.concat(o)}var t,i,d=[],m=o.minSize||10;return{addTo:function(r){t=o.featureGroup||r,i=r,t.on("layeradd",n),i.on("zoomend",a)}}};