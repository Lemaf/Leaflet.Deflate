L.Deflate=function(e,r){function o(r,o){var a=r.getBounds(),t=e.project(a.getNorthEast(),o),d=e.project(a.getSouthWest(),o),m=t.x-d.x,u=d.y-t.y;return n>u||n>m}function a(r){var a=null,t=e.getZoom();if(o(r,e.getZoom()))for(;!a;)t+=1,o(r,t)||(a=t-1);else for(;!a;)t-=1,o(r,t)&&(a=t);return a}var t=[],n=r.minSize||10,d=r.layerGroup||e;d.on("layeradd",function(r){var o=r.layer;if(!o._layers&&o.getBounds&&!o.zoomThreshold&&!o.marker){var n=a(o),m=L.marker(o.getBounds().getCenter());o._popupHandlersAdded&&m.bindPopup(o._popup._content),o.zoomThreshold=n,o.marker=m,e.getZoom()<=n&&(d.removeLayer(o),d.addLayer(o.marker),t.push(o))}}),e.on("zoomend",function(){d!==e&&e.removeLayer(d);var r=[];d.eachLayer(function(o){e.getZoom()<=o.zoomThreshold&&(d.removeLayer(o),d.addLayer(o.marker),r.push(o))});for(var o=0;o<t.length;o++){var a=t[o];e.getZoom()>a.zoomThreshold&&(d.removeLayer(a.marker),d.addLayer(a),t.splice(o,1),o-=1)}d!==e&&e.addLayer(d),t=t.concat(r)})};